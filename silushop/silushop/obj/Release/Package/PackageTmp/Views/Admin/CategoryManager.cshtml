
<style>
    #uppwdpanel, #addpanel {
        margin-top: 10%;
        padding: 0;
    }

    #edit-ad-form > div {
        margin-bottom: 5px;
    }
</style>
<script>
    //获取用户列表
    function GetCategoryList() {
        waiting();
        $.get("CategoryList", null, function (data) {
            $("#categorybody").html(data);
            waitingHide();
        }, "html");

    }
    //更改管理员状态
    function CStatus(ID, e) {
        waiting();
        var status = 1;
        if (e.value == "启用")
        { status = 0; }
        $.post("UpdateCategoryStatus", "id=" + ID + "&status=" + status, function (data) {
            if (data.code == "1") {
                if (status == 1) {
                    e.value = "启用";
                } else {
                    e.value = "禁用";
                }
            } else {
                alert(data.msg);
            }
            waitingHide();
        }, "json")
    }
    function addClose() {
        $("#addpanel input:not([type='button'])").val("");
        $("#Location").val(1);
        $("#EditCategory").hide();
        $("#adimgshow").attr("src", "/img/noimg.png");
    }
    function EditCategory(ID) {
        waiting();
        $.post("Category", "id=" + ID, function (data) {
            $("#ID").val(data.ID);
            $("#Name").val(data.Name);
            $("#Title").val(data.Title);
            $("#SrcDetail").val(data.SrcDetail);
            $("#HeadID").val(data.HeadID);
            if (data.SrcDetail==null||data.SrcDetail == "" || data.SrcDetail.length == 0) {
                $("#categoryshow").attr("src", "/img/noimg.png");
            } else {
                $("#categoryshow").attr("src", data.Img);
            }

            $("#Descrition").val(data.Descrition);
            $("#OrderID").val(data.OrderID);
            waitingHide();
            $("#EditCategory").show();
        }, "json");
    }
    function addCategory() {
        waiting();
        $.post("EditCategory", $("#edit-ad-form").serialize(), function (data) {
            alert(data.msg);
            if (data.code == "1") {
                GetCategoryList();
            }
            waitingHide();
        }, "json");
    }
    function UploadADIMG(file) {
        FileUpload(file, function (data) {
            $("#SrcDetail").val(data.msg);
            $("#categoryshow").attr("src", data.msg);
        });
    }
    $(document).ready(function () {
        $.post("GetCategoryByHeadID", "ID=0", function (data) {
            var html = "<option value='0'></option>";
            for (var i = 0; i < data.length; i++) {
                html += "<option value='" + data[i].ID + "'>" + data[i].Name + "</option>";
            }
            $('#HeadID').html(html);
        });
    });
</script>
<ol class="breadcrumb">
    <li><a onclick="GetManager('Default')">首页</a></li>
    <li><a href="#">商品分类管理</a></li>
</ol>
<div class="col-lg-12 form-inline">

    关键字：
    <div class="input-group col-lg-4">
        <input type="text" class="form-control" id="key">
        <span class="input-group-addon" onclick="USearch()">查询</span>
    </div>
    <input value="新增" type="button" class="btn btn-primary" onclick="$('#EditCategory').show()" />
    <div class="col-lg-12" id="categorylist">
        <table class="table table-hover">
            <thead>
                <tr>
                    <th>上级分类</th>
                    <th>名称</th>
                    <th>标题</th>
                    <th>图片</th>
                    <th>描述</th>
                    <th>排序</th>
                    <th>是否可见</th>
                    <td>操作</td>
                </tr>
            </thead>
            <tbody id="categorybody">
                @Html.Action("CategoryList")
            </tbody>
        </table>
        <nav aria-label="Page navigation">
            <ul class="pagination"></ul>
        </nav>
    </div>
</div>
<div class="showBack col-md-12" id="EditCategory">
    <div class="panel panel-danger col-md-4 col-md-offset-4" id="addpanel">
        <div class="panel-heading">
            编辑分类<input type="button" class="btn btn-default" style="float:right;margin-top:-7px" value="关闭" onclick="addClose()" />
        </div>
        <div class="panel-body">
            <form id="edit-ad-form">
                <div class="col-md-12">
                    <input type="text" class="hidden" name="ID" id="ID" />
                    <span class="col-md-4">父分类：</span>
                    <div class="col-md-8">
                        <select id="HeadID" name="HeadID" class="form-control"></select>
                    </div>
                </div>
                <div class="col-md-12">
                    <input type="text" class="hidden" name="ID" id="ID" />
                    <span class="col-md-4">名称：</span><div class="col-md-8"><input type="text" id="Name" name="Name" class="form-control" /></div>
                </div>
                <div class="col-md-12">
                    <input type="text" class="hidden" name="ID" id="ID" />
                    <span class="col-md-4">标题：</span><div class="col-md-8"><input type="text" id="Title" name="Title" class="form-control" /></div>
                </div>
                <div class="col-md-12">
                    <span class="col-md-4">图片：</span>
                    <div class="col-md-8">
                        <input type="text" id="SrcDetail" name="SrcDetail" class="hidden" />
                        <input type="file" id="upload" onchange="UploadADIMG(this)" class="hidden" />
                        <img width="200" id="categoryshow" src="/img/noimg.png" onclick="$('#upload').click()" />
                    </div>
                </div>
                <div class="col-md-12">
                    <span class="col-md-4">是否可见：</span><div class="col-md-8">
                    @Html.DropDownList("IsShow",new List<SelectListItem> {
                            new SelectListItem() {Value="1",Text="是" },
                            new SelectListItem() {Value="0",Text="否" }
                        }, new { @class = "form-control" })
                    </div>
                </div>
                <div class="col-md-12">
                    <span class="col-md-4">描述：</span><div class="col-md-8"><input type="text" id="Descrition" name="Descrition" class="form-control" /></div>
                </div>
                <div class="col-md-12">
                    <span class="col-md-4">排序：</span><div class="col-md-8"><input type="text" id="OrderID" name="OrderID" class="form-control" /></div>
                </div>
            </form>

        </div>
        <div class="panel-footer" style="overflow:hidden">
            <input type="button" value="保存" class="btn btn-primary" style="float:right" onclick="addCategory()" />
        </div>
    </div>
</div>
