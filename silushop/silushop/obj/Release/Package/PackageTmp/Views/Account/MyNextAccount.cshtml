
@{
    Layout = null;
    int deepTotal1 = 0, deepTotal2 = 0, deepTotal3 = 0, deepTotal4 = 0;
    RelexBarDLL.Users user = Session["user"] as RelexBarDLL.Users;
}
@model List<RelexBarBLL.Models.UserLevel>
@{
    string data = "";
    //for (int i = 0; i < Model.Count; i++)
    //{
    //    if (i > 0)
    //    {
    //        data += ",";
    //    }
    //    data += "{Name:\"" + Model[i].Name + "\",TrueName:\"" + Model[i].TrueName + "\",LevelName:\"" + ((RelexBarBLL.Common.enUserLV)Model[i].Level) + "\",HeadImg:\""
    //        + Model[i].HeadImg + "\",Level:" + Model[i].Level + ",Deep:" + (Model[i].Fid.ToString() == ViewData["userid"].ToString() ? "1" : "2")
    //        + ",Name:\"" + Model[i].Name + "\",CommendID:\"" + Model[i].CommendID + "\" }";
    //}
    var childen = Model.Where(m => m.Fid == user.ID && m.CommendID == user.ID).ToList();
    deepTotal1 = childen.Count;//直推
    foreach (var temp1 in childen)
    {
        data += "{Name:\"" + temp1.Name + "\",TrueName:\"" + temp1.TrueName
            + "\",LevelName:\"" + ((RelexBarBLL.Common.enUserLV)temp1.Level) + "\",HeadImg:\"" + temp1.HeadImg
            + "\",Level:" + temp1.Level + ",Deep:" + "1 },";
    }
    /////////////////////////////////////////////////////////////////////////////
    var jianjie = new List<RelexBarBLL.Models.UserLevel>();
    //简接推
    foreach (var temp2 in childen)
    {
        foreach (var temp1 in Model.Where(m => m.Fid == temp2.ID))
        {
            jianjie.Add(temp1);
        }
    }
    jianjie = jianjie.OrderBy(m=>m.Level).ThenByDescending(m=>m.CreateTime).ToList();
    foreach (var temp1 in jianjie)
    {
        data += "{Name:\"" + temp1.Name + "\",TrueName:\"" + temp1.TrueName
            + "\",LevelName:\"" + ((RelexBarBLL.Common.enUserLV)temp1.Level) + "\",HeadImg:\"" + temp1.HeadImg
            + "\",Level:" + temp1.Level + ",Deep:" + "2 },";
        deepTotal2++;
    }
    deepTotal3 = Model.Count(m => m.Fid == user.ID && m.CommendID != user.ID);//股东号下别人的资源
    foreach (var temp1 in Model.Where(m => m.Fid == user.ID && m.CommendID != user.ID))
    {
        data += "{Name:\"" + temp1.Name + "\",TrueName:\"" + temp1.TrueName
            + "\",LevelName:\"" + ((RelexBarBLL.Common.enUserLV)temp1.Level) + "\",HeadImg:\"" + temp1.HeadImg
            + "\",Level:" + temp1.Level + ",Deep:" + "3 },";
    }
    deepTotal4 = Model.Count() - deepTotal1 - deepTotal2 - deepTotal3;//所有其他人员
    foreach (var temp1 in Model.Where(m => m.Fid != user.ID))
    {
        if (!data.Contains("\""+temp1.Name.ToString()+ "\""))
        {
            data += "{Name:\"" + temp1.Name + "\",TrueName:\"" + temp1.TrueName
                + "\",LevelName:\"" + ((RelexBarBLL.Common.enUserLV)temp1.Level) + "\",HeadImg:\"" + temp1.HeadImg
                + "\",Level:" + temp1.Level + ",Deep:" + "4 },";
        }
    }
}
<!DOCTYPE html>

<html>
<head>
    @Html.Action("Header", "Static")
    <title>@ViewData["title"]</title>
    <script>
        var data = [@Html.Raw(data)];
        function sort() {
            for (var i = 0; i < data.length; i++) {
                for (var j = i + 1; j < data.length; j++) {
                    if (data[j].Level < data[i].Level) {
                        var temp = data[i];
                        data[i] = data[j];
                        data[j] = temp;
                    }
                }
            }
        }
        function GetHeadImg(img) {
            if (img == null || img == "") {
                return "/img/defaulthead.jpg";
            }
            return img;
        }
        $(function () {
            //sort();
            change(1);
        });
        function itemClick(e) {
            var $input = $(e).parent().find("input");
            if ($input.val() == "+") {
                $input.val("-");
                $(e).parents("li").find("ul").slideDown();
            } else {
                $(e).parents("li").find("ul").slideUp();
                $input.val("+");
            }
        }
        function change(v) {
            $(".clearfix li").removeClass("active");
            $(".clearfix li").eq(v - 1).addClass("active");

            var levellist = [];
            var templv = 0;
            var levelindex = 0;
            for (var i = 0; i < data.length; i++) {
                if (data[i].Deep == v) {
                    if (levellist.length == 0) {
                        levellist.push({ Level: data[i].Level, LevelName: data[i].LevelName, List: [] });
                    } else {
                        if (templv < data[i].Level) {
                            levellist.push({ Level: data[i].Level, LevelName: data[i].LevelName, List: [] });
                            levelindex++;
                        }
                    }
                    if (levellist[levelindex].Level == data[i].Level) {
                        levellist[levelindex].List.push(data[i]);
                    }
                    templv = data[i].Level;
                }
            }
            var temphtml = [];
            for (var i = 0; i < levellist.length; i++) {
                temphtml.push('<li><input class="y" type="button" onclick="itemClick(this)" value="+"/><a onclick="itemClick(this)">' + levellist[i].LevelName + '(' + levellist[i].List.length + ')</a><ul class="userlist">');
                for (var j = 0; j < levellist[i].List.length; j++) {
                    temphtml.push('<li><img class="uhead" src="' + GetHeadImg(levellist[i].List[j].HeadImg) + '"/><strong class="uname">' + levellist[i].List[j].TrueName + '（' + levellist[i].List[j].Name + '）</strong></li>');
                }
                temphtml.push('</ul></li>');
            }
            $("#list").html(temphtml.join(""));
        }
    </script>
    <style>
        .y {
            border: .2rem solid;
            display: block;
            margin: 0;
            padding: 0 !important;
            width: 2rem;
            height: 2rem;
            text-align: center;
            border-radius: 50%;
            position: relative;
            top: 1rem;
            float: left;
            z-index: 1000;
            margin-top: .4rem;
            margin-left: 1rem;
            vertical-align: central !important;
            box-sizing: initial !important;
            background-color: white;
        }

        .clearfix > li > a {
            padding-left: 4rem;
        }

        .userlist {
            display: none;
        }

            .userlist > li {
                height: 6rem;
                border-bottom: 1px solid white;
                padding-left: 4rem;
                background-color: #f4f4f4;
            }

        .uhead {
            box-sizing: border-box;
            border: .1rem solid #666;
            width: 5rem;
            height: 5rem;
            border-radius: 50%;
            margin-top: .5rem;
        }

        .uname {
            margin-left: 2rem;
        }
    </style>
</head>

<body>
    <div class="header">
        <h3>@ViewData["title"]</h3>
        <a onclick="window.history.back()" title=""><i class="icon-chevron-thin-left"></i></a>
    </div>
    <div class="carttopnav">
        <ul class="clearfix">
            @if (user.LV == (int)RelexBarBLL.Common.enUserLV.股东)
            {
                <li data-s="" style="width:25%" class="active"><a href="javascript:change(1)">一度人脉(@deepTotal1 人)</a></li>
                <li data-s="" style="width:25%"><a href="javascript:change(2)">二度人脉(@deepTotal2 人)</a></li>
                <li data-s="" style="width:25%"><a href="javascript:change(3)">三度人脉(@deepTotal3 人)</a></li>
                <li data-s="" style="width:25%"><a href="javascript:change(4)">市场人员(@deepTotal4 人)</a></li>
            }
            else
            {
                <li data-s="" style="width:50%" class="active"><a href="javascript:change(1)">一度人脉(@deepTotal1 人)</a></li>
                <li data-s="" style="width:50%"><a href="javascript:change(2)">二度人脉(@deepTotal2 人)</a></li>
            }
        </ul>
    </div>
    <div class="titlelist">
        <ul class="clearfix" id="list"></ul>
    </div>
</body>
</html>
