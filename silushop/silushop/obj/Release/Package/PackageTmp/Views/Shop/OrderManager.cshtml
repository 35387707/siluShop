
<script>
    var hasFooter = false;
    var OrderManager = {};
    function createFooter(sum) {
        if (!hasFooter) {
            $(".pagination").createPage({

                totalPage: parseInt((sum - 1) / 10 + 1),
                // totalPage: 10,
                currPage: 1,
                backFn: function (p) {
                    GetOrderList(p);
                }
            });
            hasFooter = true;
        }

    }
    function toPage(index) {
        GetOrderList(index);
    };
    function search() {
        var datareg = /((^((1[8-9]\d{2})|([2-9]\d{3}))([-\/\._])(10|12|0?[13578])([-\/\._])(3[01]|[12][0-9]|0?[1-9])$)|(^((1[8-9]\d{2})|([2-9]\d{3}))([-\/\._])(11|0?[469])([-\/\._])(30|[12][0-9]|0?[1-9])$)|(^((1[8-9]\d{2})|([2-9]\d{3}))([-\/\._])(0?2)([-\/\._])(2[0-8]|1[0-9]|0?[1-9])$)|(^([2468][048]00)([-\/\._])(0?2)([-\/\._])(29)$)|(^([3579][26]00)([-\/\._])(0?2)([-\/\._])(29)$)|(^([1][89][0][48])([-\/\._])(0?2)([-\/\._])(29)$)|(^([2-9][0-9][0][48])([-\/\._])(0?2)([-\/\._])(29)$)|(^([1][89][2468][048])([-\/\._])(0?2)([-\/\._])(29)$)|(^([2-9][0-9][2468][048])([-\/\._])(0?2)([-\/\._])(29)$)|(^([1][89][13579][26])([-\/\._])(0?2)([-\/\._])(29)$)|(^([2-9][0-9][13579][26])([-\/\._])(0?2)([-\/\._])(29)$))/;
        var Number = $("#Number").val();
        var begintime = $("#beginTime").val();
        var endtime = $("#endTime").val();
        var type = $("#type").val();
        var status = $("#status").val();
        if (begintime != ""&&!datareg.test(begintime)) {
            alert("开始日期格式不正确！");
        }
        if (endtime != "" && !datareg.test(endtime)) {
            alert("结束日期格式不正确！");
        }
        OrderManager.Number = Number;
        OrderManager.beginTime = begintime;
        OrderManager.endTime = endtime;
        OrderManager.type = type;
        OrderManager.status = status;
        $(".pagination").html("");
        hasFooter = false;
        GetOrderList(1);
    }
    //获取用户列表
    function GetOrderList(index) {
        waiting();
        $.get("/Shop/OrderManagerList", "index=" + index + "&Number=" + OrderManager.Number + "&beginTime=" + OrderManager.beginTime + "&endTime=" + OrderManager.endTime + "&type=" + OrderManager.type
            + "&status=" + OrderManager.status, function (data) {
            $("#orderlistbody").html(data);
            waitingHide();
            }, "html")
    }
    function CancelOrder(id,e) {
        if (confirm("该订单下的所有商品将取消？")) {
            waiting();
            $.post("/Admin/CancelOrder/" + id, null, function (data) {
                if (data.code == 1) {
                    var num = $(e).parent().parent().children().eq(0).text();

                    $("#orderlistbody").children().each(function () {
                        if (num == $(this).children().eq(0).text()) {
                            $(this).find(".order_status").text("已取消")
                            $(this).children().eq(11).html("");
                        }
                    });
                } else {
                    alert(data.msg);
                }
                waitingHide();
            }, "json");
        }
    }
    function orderSend(id, e) {
        if (confirm("确认发货？")) {
            waiting();
            $.post("/Admin/OrderSend/" + id, null, function (data) {
                if (data.code == 1) {
                    var num = $(e).parent().parent().children().eq(0).text();

                    $("#orderlistbody").children().each(function () {
                        if (num == $(this).children().eq(0).text()) {
                            $(this).find(".order_status").text("已发货")
                            $(this).children().eq(10).html("");
                        }
                    });
                } else {
                    alert(data.msg);
                }
                waitingHide();
            }, "json");
        }
    }

    $(function () {
        search();
    });
</script>
<ol class="breadcrumb">
    <li><a onclick="GetManager('ManagerDefault')">首页</a></li>
    <li><a href="#">订单管理</a></li>
</ol>
<div class="col-md-12 form-inline">
    <div class="col-md-11">
        <div class="col-md-6">
            订单号：<input type="text" class="form-control" id="Number" name="Number">
        </div>
        <div class="col-md-6">
            订单状态：
            <select class="form-control" id="status" name="status">
                <option value="">请选择</option>
                <option value="-1">已取消</option>
                <option value="0">待付款</option>
                <option value="1">已支付</option>
                <option value="2">已发货</option>
                <option value="3">已收货</option>
                <option value="4">已完成订单</option>
                <option value="5">退货中</option>
            </select>
        </div>
        <div class="col-md-12" style="margin-top:10px;padding-left:0px">
            <div class="col-md-6">
                开始时间：<input type="text" class="form-control" id="beginTime" name="beginTime" placeholder="格式：yyyy-MM-dd" onclick="WdatePicker({el:this,dateFmt:'yyyy-MM-dd'})" />
            </div>
            <div class="col-md-6">
                结束时间：<input type="text" class="form-control" id="endTime" name="endTime" placeholder="格式：yyyy-MM-dd" onclick="WdatePicker({el:this,dateFmt:'yyyy-MM-dd'})" />
            </div>
        </div>
    </div>
    <div class="input-group col-md-1" style="margin-top:20px;">
        <input type="button" class="btn btn-primary" value="查询" onclick="search()" />
    </div>
    <div class="col-md-12" id="OrderList">
        <table class="table table-hover">
            <thead>
                <tr>
                    <th>订单编号</th>
                    <th>下单时间</th>
                    <th>订单状态</th>
                    <th>订单金额</th>
                    <th>订单总金额</th>
                    <th>商品名称</th>
                    <th>商品图片</th>
                    @*<th>商品分类</th>*@
                    <th>订单类型</th>
                    <th>购买数量</th>
                    <th>收货人信息</th>
                    <th>操作</th>
                </tr>
            </thead>
            <tbody id="orderlistbody"></tbody>
        </table>
        <nav aria-label="Page navigation">
            <ul class="pagination"></ul>
        </nav>
    </div>
</div>

