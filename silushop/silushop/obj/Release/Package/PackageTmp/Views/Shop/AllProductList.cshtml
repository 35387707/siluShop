
@{
    Layout = null;
}
@model string
<!DOCTYPE html>

<html>
<head>
    @Html.Action("Header", "Static")
    <title>商城</title>
    <style>
        #ProductList li img{height:14rem;}
    </style>
    <script>
        var Product = {};
        Product.orderby = 0;
        Product.key = "@Model";
        function GetProductList(index) {
            Product.index = index;
            $.post("/Shop/MobileProductList", "index=" + index + "&Category="+@Request.QueryString["cid"] + "&OrderType="+ Product.orderby + "&key=" + Product.key, function (data) {
                if (index == 1) {
                    $("#ProductList").html("");
                }
                if (data.length != 0) {
                    syncStatus = 1;
                    var temp = [];

                    for (var i = 0; i < data.length; i++) {
                        temp.push('<li><a href="/Shop/ProductDetail/' + data[i].ID + '" title=""><div class="porduct_list_pic"><img src="' + data[i].Img + '" alt=""></div><h4>' + data[i].Name + '</h4><div class="price clearfix"><span>￥' + data[i].Price + '</span><b>' + data[i].RealPrice + '易物券</b></div></a></li>');
                    }
                    $("#ProductList").append(temp.join(""));

                    //console.log(data);
                }
            }, "json")
        }
        $(function () {
            GetProductList(1);

            syncTopStatus = 1;
            syncStatus = 1;
            $("body").on("touchstart", function (e) {
                // e.preventDefault();
                startX = e.originalEvent.changedTouches[0].pageX;
                startY = e.originalEvent.changedTouches[0].pageY;

            });
            $("body").on("touchmove", function (e) {
                endX = e.originalEvent.changedTouches[0].pageX;
                endY = e.originalEvent.changedTouches[0].pageY;
                var y = endY - startY;
                if (Math.abs(y) > 100) {
                    if (y > 0) {

                        //alert("向下");
                    } else {
                        if (syncStatus == 1) {
                            syncStatus = 0;
                            GetProductList(++Product.index);
                        }
                        //alert("向上");
                    }
                }

            });
            $("#search").on("click", function () {
                var key = $("#key").val();
                Product.key = key;
                GetProductList(1);
            });
            $("#orderby li").on("click", function () {
                var hasActive = $(this).hasClass("active");
                $("#orderby li").removeClass("active");
                $(this).addClass("active");
                var orderby = parseInt($(this).attr("data-v"));
                var $span = $(this).find("span");
                var updown = $span.attr("class");
                $span.removeClass(updown);

                if (orderby >= 0) {
                    Product.orderby = orderby;
                } else {
                    if (hasActive) {
                       // console.log(updown);
                        if (updown == "up") {
                            $span.addClass("down");
                            orderby == -1 ? Product.orderby = 4 : Product.orderby = 6;

                        } else {
                            $span.addClass("up");
                            orderby == -1 ? Product.orderby = 3 : Product.orderby = 5;
                        }
                    } else {
                        $span.addClass("up");
                        orderby == -1 ? Product.orderby = 3 : Product.orderby = 5;
                    }
                }
                GetProductList(1);
            });
        });
    </script>
</head>
<body class="bgf4f4f4">
    <div class="list_search">
        <div class="list_searchbox">
            <input type="text" id="key" value="@Model" class="list_searchtxt" placeholder="搜索" style="color:black" />
            <span><input type="button" id="search" value="" style="color:black" /><i class="icon-search"></i></span>
        </div>
        <a onclick="window.history.back()" title="" class="more"><i class="icon-chevron-thin-left"></i></a>
    </div>
    <div class="list_sort">
        <ul class="clearfix" id="orderby">
            <li data-v="0" class="active"><a title="">综合</a></li>
            <li data-v="2"><a title="">新品</a></li>
            <li data-v="-1">
                <a title=""><span class="up">销量<i class="icon-triangle-down"></i><i class="icon-triangle-down"></i></span></a>
            </li>
            <li data-v="-2"><a title=""><span class="down">价格<i class="icon-triangle-down"></i><i class="icon-triangle-down"></i></span></a></li>
        </ul>
    </div>
    <div class="porduct_list">
        <ul class="clearfix" id="ProductList">
        </ul>
    </div>
    <div class="footnavbox"></div>
    <div class="footnav">
        @Html.Action("ShopFooter", "Static", new { id = 1 })
    </div>
</body>
</html>
