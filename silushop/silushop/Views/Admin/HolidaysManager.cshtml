<style>
    #editConfigpanel {
        padding: 0;
        margin-top: 10%;
    }
    .input_text{width:100%;height:100%;border:none;}
    .wd100 {width:100% !important;}
</style>
<script>
    //获取用户列表
    function GetHolidaysList(year) {
        waiting();
        $.post("GetHolidaysList", "year=" + year, function (data) {
            var data = JSON.parse(data);
            data = JSON.parse(data);
            var temphtml = [];
            for (var i = 0; i < data.length; i++) {
                temphtml.push('<tr><td><input type="checkbox"/></td><td><input name="date" class="hidden" value="' + data[i].Date + '"/>' + data[i].Date + '</td><td><input name="remark" class="hidden" value="'+data[i].Remark+'"/>'+data[i].Remark+'</td><td><input type="button" class="btn btn-danger" onclick="delrow(this)" value="删除"></td></tr>');
            }
            $("#Holidaysbody").html(temphtml.join(""));
            waitingHide();
        }, "html")
    }
    function USearch() {
        GetHolidaysList($("#year").val());
    }
    function URLencode(sStr) {
        return escape(sStr).replace(/\+/g, '%2B').replace(/\"/g, '%22').replace(/\'/g, '%27').replace(/\//g, '%2F');
    }
    
    function createSearch() {
        var year = new Date().getFullYear();
        temphtml = [];
        for (var i = 0; i < 10; i++) {
            temphtml.push('<option value="' + (year + i) + '">' + (year + i) + '</option>');
        }
        $("#year").html(temphtml.join(""));
        USearch();
    }
    $(function(){
        createSearch();
        $("#Holidayslist>table>thead input[type='checkbox']").on("click", function () {
            $("#Holidaysbody input[type='checkbox']").prop("checked", $(this).prop("checked"));
        });
    })
    function createWeekend() {
        var year=$("#year").val();
        var nowdate = new Date( year+ "-1-1");
        var temphtml = [];
        while(nowdate.getFullYear()==year){
            switch (nowdate.getDay()) {
                case 0:
                    temphtml.push('<tr><td><input type="checkbox"/></td><td><input name="date" class="hidden" value="' + formartdate(nowdate) + '"/>' + formartdate(nowdate) + '</td><td><input name="remark" class="hidden" value="周日"/>周日</td><td><input type="button" class="btn btn-danger" onclick="delrow(this)" value="删除"></td></tr>');
                    break;
                case 6:
                    temphtml.push('<tr><td><input type="checkbox"/></td><td><input name="date" class="hidden" value="' + formartdate(nowdate) + '"/>' + formartdate(nowdate) + '</td><td><input name="remark" class="hidden" value="周六"/>周六</td><td><input type="button" class="btn btn-danger" onclick="delrow(this)" value="删除"></td></tr>');
                    break;
                default:

            }
            nowdate.setDate(nowdate.getDate()+1);
        }
        $("#Holidaysbody").append(temphtml.join(""));
    }
    function holidaySave() {
        var year = $("#year").val();
        var datalist = [];
        $("#Holidaysbody tr").each(function () {
            var tdate= $(this).find("input[name='date']").val();
            var tremark = $(this).find("input[name='remark']").val();
            datalist.push({Date:tdate,Remark:tremark});
        });
        $.post("/Admin/UpdateHolidaysList", { year: year, list: datalist }, function (data) {
            alert(data.msg);
        }, "json")
    }
    function createnewrow() {
        $("#Holidaysbody").prepend('<tr><td><input type="checkbox"/></td><td><input readonly name="date" class="form-control wd100" value="" onclick="WdatePicker({el:this,dateFmt:\'yyyy-MM-dd\'})"/></td><td><input name="remark" class="form-control wd100" value=""/></td><td><input type="button" class="btn btn-danger" onclick="delrow(this)" value="删除"></td></tr>');
    }
    function delselect() {
        $("#Holidaysbody tr input[type='checkbox']:checked").parents("tr").remove();
    }
    function delrow(e) {
        $(e).parents("tr").remove();
    }

    function formartdate(date) {
        return dateformart("yyyy-MM-dd",date);
    }

    function dateformart(fmt, date) { //author: meizz   
        var o = {
            "M+": date.getMonth() + 1,                 //月份   
            "d+": date.getDate(),                    //日   
            "h+": date.getHours(),                   //小时   
            "m+": date.getMinutes(),                 //分   
            "s+": date.getSeconds(),                 //秒   
            "q+": Math.floor((date.getMonth() + 3) / 3), //季度   
            "S": date.getMilliseconds()             //毫秒   
        };
        if (/(y+)/.test(fmt))
            fmt = fmt.replace(RegExp.$1, (date.getFullYear() + "").substr(4 - RegExp.$1.length));
        for (var k in o)
            if (new RegExp("(" + k + ")").test(fmt))
                fmt = fmt.replace(RegExp.$1, (RegExp.$1.length == 1) ? (o[k]) : (("00" + o[k]).substr(("" + o[k]).length)));
        return fmt;
    }
</script>
<ol class="breadcrumb">
    <li><a onclick="GetManager('Default')">首页</a></li>
    <li><a href="#">节假日管理</a></li>
</ol>
<div class="col-lg-12 form-inline">

    
    <div class="col-md-4">
        选择年份：<select id="year" class="form-control" onchange="USearch()"></select>
        @*<span class="btn btn-default" onclick="USearch()">查询</span>*@
    </div>
    
    <div class="col-md-12" id="Holidayslist">
        <div>
            <input type="button" class="btn btn-success" value="新建" onclick="createnewrow()" />
            <input type="button" class="btn btn-success" value="生成周末日期" onclick="createWeekend()"/>
            <input type="button" class="btn btn-danger" value="删除选中项" onclick="delselect()"/>
            <input type="button" style="float:right" class="btn btn-primary" value="保存" onclick="holidaySave()"/>
            <input type="button" style="float:right" class="btn btn-danger" onclick="$('#Holidaysbody').html('')" value="清空" />
        </div>
        <table class="table table-striped table-bordered table-hover" style="table-layout: fixed;word-break : break-all;">
            <thead>
                <tr>
                    <td><input type="checkbox"/></td>
                    <th>日期</th>
                    <th>备注</th>
                    <th>操作</th>
                </tr>
            </thead>
            <tbody id="Holidaysbody">
            </tbody>
        </table>
    </div>
</div>