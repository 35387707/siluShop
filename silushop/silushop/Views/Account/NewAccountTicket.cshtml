
@{
    Layout = null;
    RelexBarDLL.Users u = Session["user"] as RelexBarDLL.Users;
    var ot = new RelexBarBLL.UsersBLL().CanYashangTihuo(u.ID);
}
@model List<RelexBarBLL.Models.MyTicket>
<!DOCTYPE html>

<html>
<head>
    @Html.Action("Header", "Static")
    <title>开户券</title>
    <style>
        .kh {
            background: #85dd1d;
            display: inline-block;
            color: white;
            position: absolute;
            right: 1rem;
            top: 1.1rem;
            padding: .5rem;
        }

        .kh2 {
            background: none;
            display: inline-block;
            color: #999;
            position: absolute;
            right: 1rem;
            top: 1.1rem;
            padding: .5rem;
        }

        .tickerdate {
            color: red;
            font-size: .8rem;
            position: absolute;
            top: .2rem;
            left: 11rem;
        }
    </style>
    <script>
        function qrsh(id, e) {
            if (confirm("确认收货？")) {
                $.post("/Account/RecOrder/" + id, null, function (data) {
                    if (data.code == 1) {
                        $(e).parent().removeClass("kh");
                        $(e).parent().addClass("kh2");
                        $(e).parent().html("<span>已收货</span>");
                    } else {
                        alert(data.msg);
                    }
                }, "json");
            }
        }
    </script>
</head>
<body class="bgf4f4f4">
    <div class="header">
        <h3>我的提货券</h3>
        <a onclick="window.history.back()" title=""><i class="icon-chevron-thin-left"></i></a>
    </div>
    <div class="center_links">
        <ul>
            @for (int i = 0; i < Model.Count; i++)
            {
                if (Model[i].IsBuyProduct == 0)
                {
                    <li>
                        <a href="#" title="">
                            <h5>@Model[i].Price</h5>
                            <div class="center_links_icon2"><img src="/images/ico17.png" alt=""></div>
                        </a>
                        <span class="tickerdate">有效期<br />@Model[i].CreateTime.AddMonths(1).ToString("yyyy-MM-dd")<br />日截止</span>
                        <a class="kh" href="/Home/ProductDetail/@Model[i].PID"><span>立即提货</span></a>
                    </li>
                }
                else
                {
                    <li>
                        <a href="#" title="">
                            <h5>@Model[i].Price</h5>
                            <div class="center_links_icon2"><img src="/images/ico17.png" alt=""></div>
                        </a>
                        <span class="tickerdate"></span>
                        @if (Model[i].OrderStatus != null)
                        {
                            if (Model[i].OrderStatus == 4)
                            {
                                <a class="kh2"><span>已收货</span></a>
                            }
                            else
                            {
                                <a class="kh"><span @(Model[i].OrderStatus.Value == 2 ? "onclick=qrsh(\"" + Model[i].OPID + "\",this)" : "")>@(Model[i].OrderStatus.Value == 1 ? "等待发货" : Model[i].OrderStatus.Value == 2 ? "确认收货" : "")</span></a>
                            }
                        }
                    </li>
                }
}
        </ul>
    </div>
    <div class="footnavbox"></div>
</body>
</html>
